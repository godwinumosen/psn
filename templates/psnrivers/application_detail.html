{% extends "base.html" %}
{% block title %} Application Details {% endblock %}
{% block content %}

<!-- Page Header -->
<div class="page-title py-5 bg-success mb-5">
  <div class="container text-white">
    <p>
      <a href="/" class="text-white-50 text-decoration-none">Home</a>
      <span class="mx-2">></span> Application Details
    </p>
    <h1 class="display-4 fw-bold"style="font-size: 35px;">Application Details</h1>
    <p class="lead mb-0"style="font-size: 16px;">View application details</p>
  </div>
</div>

<!-- Content -->
<div class="container mb-5">
  <div class="card border-0 shadow-sm rounded-4">
    <div class="card-body p-4">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
          <h4 class="fw-bold mb-1">Application Details</h4>
          <p class="text-muted mb-0">
            Review the clearance application for {{ app.full_name }}
          </p>
        </div>
      </div>

      <!-- Status + Date -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <span class="badge rounded-pill 
          {% if app.status == 'Pending' %}bg-warning text-dark
          {% elif app.status == 'Approved' %}bg-success
          {% elif app.status == 'Declined' %}bg-danger
          {% else %}bg-secondary{% endif %} px-3 py-2">
          {{ app.status }}
        </span>

        <small class="text-muted">
          Submitted: {{ app.submitted_at|date:"F j, Y" }}
        </small>
      </div>

      <!-- Details -->
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <small class="text-muted">Full Name</small>
          <p class="fw-semibold mb-0">{{ app.full_name }}</p>
        </div>

        <div class="col-md-6">
          <small class="text-muted">Membership Number</small>
          <p class="fw-semibold mb-0">{{ app.membership_number }}</p>
        </div>

        <div class="col-md-6">
          <small class="text-muted">Technical Group</small>
          <p class="fw-semibold mb-0">{{ app.technical_group }}</p>
        </div>

        <div class="col-md-6">
          <small class="text-muted">Clearance Year</small>
          <p class="fw-semibold mb-0">{{ app.clearance_year }}</p>
        </div>
      </div>

      <!-- Submitted Documents -->
      <div class="mb-4">
        <h6 class="fw-semibold mb-3">Submitted Documents</h6>
        <div class="row g-3">

          <!-- Proof of Payment -->
          <div class="col-md-4">
            <div class="card h-100 text-center border rounded-4">
              <div class="card-body">
                <div class="fs-3 mb-2">ðŸ“„</div>
                <p class="fw-semibold mb-1">Proof of Payment</p>
                <a href="{{ app.proof_of_payment.url }}" class="btn btn-sm btn-outline-success">
                  View File
                </a>
              </div>
            </div>
          </div>

          <!-- Supporting Document -->
          {% if app.supporting_document %}
          <div class="col-md-4">
            <div class="card h-100 text-center border rounded-4">
              <div class="card-body">
                <div class="fs-3 mb-2">ðŸ“„</div>
                <p class="fw-semibold mb-1">Supporting Document</p>
                <a href="{{ app.supporting_document.url }}" class="btn btn-sm btn-outline-success">
                  View File
                </a>
              </div>
            </div>
          </div>
          {% endif %}

        </div>
      </div>

      <!-- Actions -->
      <div class="d-flex justify-content-end gap-2">
        <a href="{% url 'review_applications' %}" class="btn btn-outline-secondary px-4">
          Back
        </a>

        {% if app.status == 'Pending' %}
        <!-- Approve -->
        <form method="post" class="d-inline">
          {% csrf_token %}
          <button name="action" value="approve" class="btn btn-success px-4">
            âœ” Approve
          </button>
        </form>

        <!-- Decline Trigger -->
        <button
          class="btn btn-danger px-4"
          data-bs-toggle="modal"
          data-bs-target="#declineModal">
          âœ– Decline
        </button>
        {% endif %}
      </div>

    </div>
  </div>
</div>

<!-- Decline Modal -->
<div class="modal fade" id="declineModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <form method="post">
        {% csrf_token %}

        <div class="modal-header">
          <h5 class="modal-title text-danger fw-bold">
            Decline Application
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <p class="text-success">
            Please select a reason for declining this application.
            This feedback will be visible to the applicant.
          </p>

          <div class="mb-3">
            <label class="form-label fw-semibold">
              Reason for Decline <span class="text-danger">*</span>
            </label>
            <select name="decline_reason" class="form-select border border-2 border-success text-success" style="border-color: #198754;" required>
              <option value="" selected disabled>Select a reason</option>
              <option value="Wrong clearance year uploaded">Wrong clearance year uploaded</option>
              <option value="Incomplete clearance documents">Incomplete clearance documents</option>
              <option value="Unclear or unreadable receipt">Unclear or unreadable receipt</option>
              <option value="Incorrect document uploaded">Incorrect document uploaded</option>
              <option value="Proof of payment missing">Proof of payment missing</option>
              <option value="Payment not verifiable">Payment not verifiable</option>
              <option value="Membership status not active">Membership status not active</option>
              <option value="Name mismatch between records">Name mismatch between records</option>
              <option value="Application information incomplete">Application information incomplete</option>
              <option value="Does not meet clearance requirements">Does not meet clearance requirements</option>
              <option value="Pending verification â€“ resubmit later">Pending verification â€“ resubmit later</option>
              <option value="Other">Other</option>
            </select>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Cancel
          </button>

          <button
            type="submit"
            name="action"
            value="decline"
            class="btn btn-danger">
            Confirm Decline
          </button>
        </div>

      </form>

    </div>
  </div>
</div>

{% endblock %}
